@page
@model HomeModel
@inject Hubletix.Infrastructure.Services.IHomePageComponentRegistry ComponentRegistry
@using Hubletix.Core.Models
@using Hubletix.Api.Models
@using Hubletix.Core.Constants
@{
    ViewData["Title"] = $"{Model.CurrentTenantInfo?.Name ?? "Home"} - Home";
    Layout = "_PublicLayout";
}

@if (Model.HomePage.Components != null && Model.HomePage.Components.Count > 0)
{
    var primaryColor = !string.IsNullOrEmpty(Model.HomePage.PrimaryColor) 
        ? Model.HomePage.PrimaryColor 
        : ThemeDefaults.PrimaryColor;
    var secondaryColor = !string.IsNullOrEmpty(Model.HomePage.SecondaryColor) 
        ? Model.HomePage.SecondaryColor 
        : ThemeDefaults.SecondaryColor;
    
    foreach (HomePageComponentViewModel component in Model.HomePage.Components.OrderBy(c => c.Order))
    {
        var partialPath = ComponentRegistry.GetPartialViewPath(component.GetType());
        
        if (!string.IsNullOrEmpty(partialPath))
        {
            // Create render context for this component
            object? renderContext = null;
            
            if (component is HeroComponentViewModel hero)
            {
                renderContext = new ComponentRenderContext<HeroComponentViewModel>
                {
                    Component = hero,
                    PrimaryColor = primaryColor,
                    SecondaryColor = secondaryColor,
                    IsPreviewMode = false
                };
            }
            else if (component is CardsComponentViewModel cards)
            {
                renderContext = new ComponentRenderContext<CardsComponentViewModel>
                {
                    Component = cards,
                    PrimaryColor = primaryColor,
                    SecondaryColor = secondaryColor,
                    IsPreviewMode = false
                };
            }
            
            if (renderContext != null)
            {
                <partial name="@partialPath" model="renderContext" />
            }
        }
    }
}
else
{
    <!-- Default empty state -->
    <section class="py-5">
        <div class="container text-center">
            <div class="py-5">
                <h1 class="display-4 mb-3">Welcome to @Model.CurrentTenantInfo?.Name</h1>
                <p class="lead text-muted">Your homepage is being configured. Check back soon!</p>
            </div>
        </div>
    </section>
}
