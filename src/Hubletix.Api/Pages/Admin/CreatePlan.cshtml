@page "/admin/plans/create"
@using Hubletix.Core.Constants
@model CreatePlanModel
@{
    ViewData["Title"] = "Create Plan";
    ViewData["TenantName"] = Model.CurrentTenantInfo.Name;
    Layout = "_AdminLayout";
}

<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <a href="/admin/plans" class="btn btn-sm btn-outline-secondary mb-3">
                <i class="bi bi-arrow-left"></i> Back to Plans
            </a>
            <h1 class="display-5 fw-bold">Create New Membership Plan</h1>
            <p class="text-muted">Set up a new membership plan for your club.</p>
        </div>
    </div>

    @if (!string.IsNullOrEmpty(Model.ErrorMessage))
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @Model.ErrorMessage
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <div class="row">
        <div class="col-12 col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white border-bottom">
                    <h5 class="mb-0">Plan Details</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        <div class="mb-3">
                            <label asp-for="Plan.Name" class="form-label">Plan Name</label>
                            <input class="form-control" asp-for="Plan.Name" placeholder="Enter plan name" required />
                            <span asp-validation-for="Plan.Name" class="text-danger small"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Plan.Description" class="form-label">Description</label>
                            <textarea class="form-control" asp-for="Plan.Description" rows="3" placeholder="Enter plan description"></textarea>
                            <span asp-validation-for="Plan.Description" class="text-danger small"></span>
                        </div>

                        <div class="row">
                            <div class="col-12 col-md-6 mb-3">
                                <label asp-for="PriceInDollars" class="form-label">Price</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" asp-for="PriceInDollars" 
                                           step="0.01" min="0.01" placeholder="0.00" required />
                                </div>
                                <span class="text-muted small">Price in dollars</span>
                            </div>

                            <div class="col-12 col-md-6 mb-3">
                                <label asp-for="Plan.BillingInterval" class="form-label">Billing Interval</label>
                                <select class="form-select" asp-for="Plan.BillingInterval" asp-items="Model.BillingIntervalOptions" onchange="updateMonthlyDisplayVisibility()"></select>
                                <span asp-validation-for="Plan.BillingInterval" class="text-danger small"></span>
                            </div>
                        </div>

                        <div class="mb-3" id="monthlyDisplayToggle" style="display: none">
                            <label class="form-label">Display price as monthly equivalent?</label>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="IsPriceDisplayedMonthly" asp-for="Plan.IsPriceDisplayedMonthly" onchange="updatePriceDisplayLabel(this)" />
                                <label class="form-check-label" for="IsPriceDisplayedMonthly" id="priceDisplayLabel">
                                    @(Model.Plan.IsPriceDisplayedMonthly ? "Yes" : "No")
                                </label>
                            </div>
                            <span class="text-muted small">$120/year shows as $10/month</span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Plan.DisplayOrder" class="form-label">Display Order</label>
                            <input type="number" class="form-control" asp-for="Plan.DisplayOrder" min="0" placeholder="0" />
                            <span class="text-muted small">Lower numbers appear first in listings</span>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Status</label>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="isActive" asp-for="Plan.IsActive" onchange="updateStatusLabel(this)" />
                                <label class="form-check-label" for="isActive" id="statusLabel">
                                    @(Model.Plan.IsActive ? "Active" : "Inactive")
                                </label>
                            </div>
                            <span class="text-muted small">Inactive plans won't be visible to members</span>
                        </div>

                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-primary">Create Plan</button>
                            <a href="/admin/plans" class="btn btn-outline-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-12 col-lg-4">
            <div class="card border-0 shadow-sm bg-light">
                <div class="card-header bg-white border-bottom">
                    <h5 class="mb-0">Tips</h5>
                </div>
                <div class="card-body">
                    <ul class="small mb-0">
                        <li class="mb-2"><strong>Plan Name:</strong> Choose a clear, descriptive name, keeping consistent with your other plan names</li>
                        <li class="mb-2"><strong>Billing Details:</strong> Choose a recurring billing interval to optinally display pricing as a monthly equivalent</li>
                        <li class="mb-2"><strong>Display Order:</strong> Set display order to control listing position for members</li>
                        <li class="mb-2"><strong>Status:</strong> Create as inactive if you're not ready for publishing</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Update plan status label on toggle
        function updateStatusLabel(checkbox) {
            document.getElementById('statusLabel').textContent = checkbox.checked ? 'Active' : 'Inactive';
        }

        // Update plan price display label on toggle
        function updatePriceDisplayLabel(checkbox) {
            document.getElementById('priceDisplayLabel').textContent = checkbox.checked ? 'Yes' : 'No';
        }

        // Show/hide monthly display toggle based on billing interval
        function updateMonthlyDisplayVisibility() {
            const billingInterval = document.getElementById('Plan_BillingInterval').value;
            const monthlyDisplayToggle = document.getElementById('monthlyDisplayToggle');
            
            // Show the toggle only if billing interval is not Monthly
            if (
              billingInterval !== '@BillingIntervals.Monthly'
              && billingInterval !== '@BillingIntervals.OneTime'
            ){
                monthlyDisplayToggle.style.display = 'block';
            } else {
                monthlyDisplayToggle.style.display = 'none';
            }
        }

        // Initialize visibility on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateMonthlyDisplayVisibility();
        });
    </script>
</div>
